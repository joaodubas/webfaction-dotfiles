# environment variables
bindir=$HOME/local/bin
if [[ ":$PATH:" != *":$bindir:"* ]]; then
    PATH=$bindir:$PATH
    export PATH
fi

# local development
export PROJECTS=$HOME/public

# virtualenv
export WORKON_HOME=$HOME/.venv
export PROJECT_HOME=$HOME/public
. /usr/local/bin/virtualenvwrapper.sh

# todo.txt-cli configuration
export TODOTXT_CFG_FILE=$HOME/.todo/todo.cfg
. $bindir/todo_completion
alias t="todo -d $TODOTXT_CFG_FILE"
complete -F _todo t
alias punch='/usr/bin/python $bindir/punch'

# aliases
sublime() {
    $bindir/sublime $@ &
}

# update bash path
pathup() {
    local action="$1"; shift
    case "$action" in
        popd)
            [[ $# -eq 0 ]] && builtin popd || builtin popd "$*" ;;
        cd|pushd)
            builtin $action "$*" ;;
        *)
            return ;;
    esac
    PATH=`/usr/bin/python $HOME/.path_env.py`
    export PATH
}
alias cd="pathup cd"
alias pushd="pathup pushd"
alias popd="pathup popd"

# trim PS1 to show only first letters of each dir
_dir_chomp () {
    local IFS=/ c=1 n d
    local p=(${1/#$HOME/\~}) r=${p[*]}
    local s=${#r}
    while ((s>$2&&c<${#p[*]}-1))
    do
        d=${p[c]}
        n=1;[[ $d = .* ]]&&n=2
        ((s-=${#d}-n))
        p[c++]=${d:0:n}
    done
    echo "${p[*]}"
}
export PS1='`if [ $? = 0 ]; then echo "\[\033[01;32m\]✔"; else echo "\[\033[01;31m\]✘"; fi` \[\033[01;34m\]$(_dir_chomp "$(pwd)" 10)\[\033[35m\]$(__git_ps1 " %s") \[\033[01;34m\]>\[\033[00m\] '

# set terminal colors
# if [ "$TERM" = "xterm" ] ; then
#     if [ -z "$COLORTERM" ] ; then
#         if [ -z "$XTERM_VERSION" ] ; then
#             echo "Warning: Terminal wrongly calling itself 'xterm'."
#         else
#             case "$XTERM_VERSION" in
#                 "XTerm(256)") TERM="xterm-256color" ;;
#                 "XTerm(88)") TERM="xterm-88color" ;;
#                 "XTerm") ;;
#                 *)
#                     echo "Warning: Unrecognized XTERM_VERSION: $XTERM_VERSION"
#                     ;;
#             esac
#         fi
#     else
#         case "$COLORTERM" in
#             gnome-terminal)
#                 # Those crafty Gnome folks require you to check COLORTERM,
#                 # but don't allow you to just *favor the setting over TERM.
#                 # Instead you need to compare it and perform some guesses
#                 # based upon the value. This is, perhaps, too simplistic.
#                 TERM="gnome-256color"
#                 ;;
#             *)
#                 echo "Warning: Unrecognized COLORTERM: $COLORTERM"
#                 ;;
#         esac
#     fi
# fi
# export TERM="gnome-256color"
